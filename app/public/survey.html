<!DOCTYPE html>
<html>
<head>
	<title>Survey</title>

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">

	<!-- Bootstrap -->
	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>

	<!-- JQUERY -->
	<script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
</head>
<body>
	<div class="container">
		<br>
		<h2>Survey Questions</h2>
		<hr>
		<h2>About You</h2>

		<form>
			<div class="form-group">
				<label for="exampleFormControlInput1">Name (required)</label>
				<input type="email" class="form-control" id="name" placeholder="">

				<label for="exampleFormControlInput1">Link to Photo Image (required)</label>
				<input type="email" class="form-control" id="photo" placeholder="">
				<hr>
			</div>

			<div class="form-group">
				<h2>Question 1</h2>
				<label for="exampleFormControlSelect1">You are an introvert.</label>
				<select class="form-control" id="q1">
					<option value="" selected>Select an Option</option>
					<option value="1">1 (Strongly Disagree)</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5 (Strongly Agree)</option>
				</select>
				<br>

				<h2>Question 2</h2>
				<label for="exampleFormControlSelect1">You are an extrovert.</label>
				<select class="form-control" id="q2">
					<option value="" selected>Select an Option</option>
					<option value="1">1 (Strongly Disagree)</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5 (Strongly Agree)</option>
				</select>
				<br>

				<h2>Question 3</h2>
				<label for="exampleFormControlSelect1">You are both introverted and extroverted.</label>
				<select class="form-control" id="q3">
					<option value="" selected>Select an Option</option>
					<option value="1">1 (Strongly Disagree)</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5 (Strongly Agree)</option>
				</select>
				<br>

				<h2>Question 4</h2>
				<label for="exampleFormControlSelect1">You like living underwater.</label>
				<select class="form-control" id="q4">
					<option value="" selected>Select an Option</option>
					<option value="1">1 (Strongly Disagree)</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5 (Strongly Agree)</option>
				</select>
				<br>	

				<h2>Question 5</h2>
				<label for="exampleFormControlSelect1">You like living above water.</label>
				<select class="form-control" id="q5">
					<option value="" selected>Select an Option</option>
					<option value="1">1 (Strongly Disagree)</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5 (Strongly Agree)</option>
				</select>
				<br>			

				<h2>Question 6</h2>
				<label for="exampleFormControlSelect1">You like money.</label>
				<select class="form-control" id="q6">
					<option value="" selected>Select an Option</option>
					<option value="1">1 (Strongly Disagree)</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5 (Strongly Agree)</option>
				</select>
				<br>

				<h2>Question 7</h2>
				<label for="exampleFormControlSelect1">You love your job.</label>
				<select class="form-control" id="q7">
					<option value="" selected>Select an Option</option>
					<option value="1">1 (Strongly Disagree)</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5 (Strongly Agree)</option>
				</select>
				<br>				

				<h2>Question 8</h2>
				<label for="exampleFormControlSelect1">You like playing a musical instrument.</label>
				<select class="form-control" id="q8">
					<option value="" selected>Select an Option</option>
					<option value="1">1 (Strongly Disagree)</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5 (Strongly Agree)</option>
				</select>
				<br>		

				<h2>Question 9</h2>
				<label for="exampleFormControlSelect1">You want to rule the world.</label>
				<select class="form-control" id="q9">
					<option value="" selected>Select an Option</option>
					<option value="1">1 (Strongly Disagree)</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5 (Strongly Agree)</option>
				</select>
				<br>		

				<h2>Question 10</h2>
				<label for="exampleFormControlSelect1">You like karate.</label>
				<select class="form-control" id="q10">
					<option value="" selected>Select an Option</option>
					<option value="1">1 (Strongly Disagree)</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5 (Strongly Agree)</option>
				</select>
				<br>
	
				<!-- this button should submit the survey to the api AND it should display the modal -->
				<button type="button" class="btn btn-primary btn-lg btn-block submit" data-toggle="modal" data-target="#results-modal">Submit</button>
			</div>
		</form>

		<p><a href="/api/friends">API Friends List</a> | <a href="https://github.com/tiongsonkj/FriendFinder">GitHub Repo</a></p>
	</div>

	<!-- modal -->
	<div class="modal fade" id="results-modal" role="dialog">
		<div class="modal-dialog">

			<!-- modal content -->
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">x</button>
					<h2 class="modal-title">
						<strong>Best Match</strong>
					</h2>
				</div>

				<div class="modal-body">
					<h2 id="match-name"></h2>
					<img id="match-img" src="" alt="Best Match">
				</div>

				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>
	<script type="text/javascript">
		$(".submit").on("click", function(){
			event.preventDefault();

			var newFriend = {
				name: $("#name").val().trim(),
				photo: $("#photo").val().trim(),
				scores: [
					parseInt($("#q1").val().trim()),
					parseInt($("#q2").val().trim()),
					parseInt($("#q3").val().trim()),
					parseInt($("#q4").val().trim()),
					parseInt($("#q5").val().trim()),
					parseInt($("#q6").val().trim()),
					parseInt($("#q7").val().trim()),
					parseInt($("#q8").val().trim()),
					parseInt($("#q9").val().trim()),
					parseInt($("#q10").val().trim())
				]
			};

			console.log(newFriend);

			console.log("Scores of user: " + newFriend.scores);

			$.post("/api/friends", newFriend, function(data){

				// this is where we compare the data and alert the user which friend he/she matches with

				$("#match-name").text(data.name);
				$("#match-img").attr("src", data.photo);

				$("#results-modal").modal("toggle");
			});

			$.ajax({url: "http://localhost:8080" + "/api/friends", method: "GET"})
			.done(function(friendsArray) {
				var bestMatch = {
					score: null,
					index: -1
				}

				for(var i = 0; i < friendsArray.length - 1; i++) {
					// console.log(friendsArray[i]);
					console.log(friendsArray[i].scores);

					var totalDifference = 0;

					for(var j = 0; j < friendsArray[i].scores.length; j++) {
						totalDifference += Math.abs(newFriend.scores[j] - friendsArray[i].scores[j]);
					}

					console.log("Your total difference with " + friendsArray[i].name + " is: " + totalDifference);

					if(bestMatch.index === -1) {
						bestMatch.index = 1;
						bestMatch.score = totalDifference;
					}			
					else if(totalDifference < bestMatch.score) {
						bestMatch.index = i;
						bestMatch.score = totalDifference;
					}
				}

				console.log("best match index: " + bestMatch.index);
				console.log("best match score: " + bestMatch.score);
				console.log("best match name: " + friendsArray[bestMatch.index].name);
				console.log("best match photo: " + friendsArray[bestMatch.index].photo);

				$("#match-name").text(friendsArray[bestMatch.index].name);
				$("#match-img").attr("src", friendsArray[bestMatch.index].photo);
			});
		});
		// $.ajax({url: "http://localhost:8080" + "/api/friends", method: "GET"})
		// .done(function(friendsArray) {
		// 	for(var i = 0; i < friendsArray.length; i++) {
		// 		// console.log(friendsArray[i]);
		// 		console.log(friendsArray[i].scores);

		// 		var totalDifference = 0;

		// 		for(var j = 0; j < friendsArray[i].scores.length; j++) {
		// 			totalDifference += Math.abs(newFriend.scores[j] - friendsArray[i].score[j]);
		// 			console.log(totalDifference);
		// 		}			
		// 	}
		// });


	</script>
</body>
</html>